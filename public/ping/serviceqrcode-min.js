KISSY.add("pc-support/0.0.8/xmpp-util",function(a){var b={begin:!1,localMap:{},token:"",maxid:0,initOcsIm:function(b,c){var d=this;a.IO({dataType:"jsonp",url:location.protocol+"//ocsservice.taobao.com/bfm.glyz",data:{tk:b,version:2,callback:"callbackX",maxid:c},jsonp:"callbackName",success:function(b){for(var c=0;c<b.length;c++){var e=parseInt(b[c].head.id);e>d.maxid&&(d.maxid=e);var f=b[c].cmd,g=b[c].body;"string"==typeof g&&(g=g.replace("\r\n",""),g=KISSY.JSON.parse(g));var h=g.subType,i=g.data,j=d.localMap[h],k=j.param;if(f&&"qrcodeCancle"==f)return j.hide(j),void a.later(function(){d.initOcsIm(d.token,d.maxid)},2e3);k.xmppcallback({data:i,bizMap:k})}a.later(function(){d.initOcsIm(d.token,d.maxid)},700)},error:function(b,c,d){a.log(c),a.log(d)}})},setToken:function(a){this.token=a},init:function(a){var b=this;1!=b.begin&&(b.begin=!0,b.initOcsIm(a,0))},registerXmpp:function(a,b){this.localMap[a]=b}};return b}),KISSY.add("pc-support/0.0.8/index",function(a,b,c,d,e){function f(c){var d={},e=c||{},f=e.bizMap;delete e.bizMap,a.mix(d,e),a.each(f,function(a,b){d["biz_"+b]=a}),d.subType||(d.subType="qrcode"+a.guid()),d.title&&(d.title=encodeURIComponent(d.title)),this.callback=c.callback,this.param=d,this.isRender=!1,this.isBind=!1,this.xmppUtil=v;var g=this;6==b.ie&&(g.$mask4ie6=a.all('<iframe src="about:blank" style="display:none; left:-9999px; top:-9999px;" class="tb-qrcode-sb-mask-4-ie6" ></iframe>'),a.ready(function(){a.all("body").append(g.$mask4ie6)}))}var g=c.all,h=(g(document),location.href.indexOf("daily")<0?"ihelp.taobao.com":"mservice.daily.taobao.net"),i=location.protocol+"//"+h+"/getQrCode.htm",j=location.protocol+"//"+h+"/checkApp.htm",k=location.protocol+"//"+h+"/qrCodeApi.htm",l=".tb-qrcode-sb-mask-4-ie6{ border:none; position: absolute; left:0; top:0; width:1px; height:1px; background:red; filter: alpha(opacity=0); } .qrcode{font-family:simsun; position: absolute;}.qrcode .loading{width: 120px; height: 120px; background: url(//img.alicdn.com/tps/i1/T1cKm3XkRpXXXXXXXX-48-48.gif) center center no-repeat;border: 1px solid #eee;} .qrcode .qrcode-qr{background-color:#F7F7F7;border:1px solid #DDD; padding:10px;} .qrcode .qrcode-app{background-color: #f7f7f7;border: 1px solid #eee;padding: 25px 35px 21px 80px;width: 245px;background-image: url(//img.alicdn.com/tps/i3/T1LiuRFaFaXXcDFR2c-28-49.png);background-repeat: no-repeat;background-position: 25px 30px;}	.qrcode .app-title{color: #333;} .qrcode .app-body{color: #aaa;margin-top: 10px;} .qrcode .app-ft{text-align: right;margin-top: 15px;} .qrcode .app-ft a:hover{color: #ff6600;}	.qrcode .count-down, .qrcode .retry{display: inline-block; *display: inline;*zoom;width: 52px;margin-left: 12px;padding: 0 8px; line-height: 20px; cursor: pointer;text-align:center;background:#FCFCFC url(//img.alicdn.com/tps/i4/T1TgKSFiFbXXaJA2Ya-6-38.png) left top repeat-x; border: 1px solid #D0D0D0;} .retry:active{background-position:left bottom} .qrcode .count-down{padding: 0;border: 1px solid #d7d7d7;}	.qrcode .hd{padding:2px 0 10px;} .qrcode a{color:#36c;cursor:pointer;}.qrcode .bd,.qrcode .bd img{width:200px;height:200px;background:#fff;text-align:center;}.qrcode .ft{position:absolute;top:12px;right:11px;}.qrcode .ft a{display:inline-block;width:20px;height:21px;overflow:hidden;background-image:url(//img.alicdn.com/tps/i2/T12RORFmpXXXaeXpYa-20-42.png);}.qrcode .ft a:hover{background-position:0 -21px;}.qrcode .ft a span{visibility:hidden;}",m="%E6%AD%A3%E5%9C%A8%E8%8E%B7%E5%8F%96%E4%BA%8C%E7%BB%B4%E7%A0%81..",n="%E5%A6%82%E6%9E%9C%E6%89%8B%E6%9C%BA%E7%AB%AF%E5%B7%B2%E6%8F%90%E7%A4%BA%E4%B8%8A%E4%BC%A0%E6%88%90%E5%8A%9F%EF%BC%8C%3C%2Fbr%3E%E8%AF%B7",o="%E7%82%B9%E6%AD%A4%E9%A2%84%E8%A7%88",p="";p+='	<div class="qrcode">',p+='<div class="loading"></div>',p+="	</div>";var q='<div class="qrcode-qr"><div class="hd">推荐<a href="//app.taobao.com/download/taoApps.htm?spm=a210u.1000832.297503.39.REFn4e&pageIndex=5" target="_blank">淘宝客户端</a>扫描</div>';q+='<div class="bd">',q+='<div><span class="J_qrimg">'+decodeURIComponent(m)+"</span></div>",q+="</div>",q+='<div class="ft">',q+='<a href="#" class="J_close"><span>关闭</span></a>',q+="</div>",q+='<div style="margin-top:6px; text-align:center">'+decodeURIComponent(n)+'<a class="J_preview">'+decodeURIComponent(o)+"</a></div>",q+="</div></div>";var r="%E5%B7%B2%E7%BB%8F%E5%90%91%E4%BD%A0%E7%9A%84%E6%89%8B%E6%9C%BA%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%EF%BC%8C%E6%89%93%E5%BC%80%E6%B6%88%E6%81%AF%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E7%94%A8%E6%89%8B%E6%9C%BA%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%EF%BC%81",s="%E8%8B%A5%E9%95%BF%E6%97%B6%E9%97%B4%E6%B2%A1%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%8C%E5%85%88%E6%89%8B%E5%8A%A8%E5%BC%80%E5%90%AF%E6%B7%98%E5%AE%9D%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%8C%E5%86%8D%E7%82%B9%E5%87%BB%E6%8C%89%E9%92%AE%E9%87%8D%E5%8F%91%E6%B6%88%E6%81%AF",t="%E6%94%BE%E5%BC%83%E4%BC%A0%E5%9B%BE",u='<div class="qrcode-app"><div class="app-title"><h3>'+decodeURIComponent(r)+"</h3></div>";u+='<div class="app-body"><span>'+decodeURIComponent(s)+'</span><span><span class="J_QrCountdown count-down" data-count="10"></span><button class="J_QrRetry retry" type="button" style="display: none;">重试</button></span></div>',u+='<div class="app-ft"><span><a href="#" class="J_App_Cancle">'+decodeURIComponent(t)+"</a></span></div></div>";var v=e;return a.augment(f,d,{checkApp:function(){var b=this;b.param.daily&&"true"==b.param.daily&&(j=location.protocol+"//mservice.daily.taobao.net/checkApp.htm"),b.param._tt=(new Date).getTime(),a.IO({dataType:"jsonp",url:j,data:b.param,jsonpCallback:"CheckApp",success:function(a){var c=a;return b.param.qrid=c.qrid,b.param.mk=c.mk,b.param.t=c.t,b.xmppUtil.setToken(b.param.qrid),b.xmppUtil.init(b.param.qrid),c.appResult&&1==c.appResult?(b.container.html(u),b.countDown(b.container.one(".J_QrCountdown"),function(){b.container.one(".J_QrCountdown").hide(),b.container.one(".J_QrRetry").show()}),b.isCheckApp=!0,void(b.$mask4ie6&&b.$mask4ie6.css({width:362,height:173}))):(b.container.html(q),b.getQR(),b.$mask4ie6&&b.$mask4ie6.css({width:222,height:294}),void 0)}})},countDown:function(a,b){var c=this,d=a.attr("data-count")||10,e=d;a.html(e+"秒"),c.countdownInterval&&clearInterval(c.countdownInterval),c.countdownInterval=setInterval(function(){a.html(--e+"秒"),"0"==e&&(clearInterval(c.countdownInterval),b())},1e3)},getQR:function(){var b=this;b.param.daily&&"true"==b.param.daily&&(i=location.protocol+"//mservice.daily.taobao.net/getQrCode.htm"),b.param._tt=(new Date).getTime(),a.IO({dataType:"jsonp",url:i,data:b.param,jsonpCallback:"QrCodeGetPic",success:function(a){var c=a,d=b.container.one(".J_qrimg"),e=document.createElement("img");e.onload=function(){d.html("").append(e)},e.src=c.picurl}})},render:function(){var b=this,c=g(p);a.DOM.addStyleSheet(l),g(document.body).append(c),b.container=c,b.isRender=!0,b.bindEvent(),b.xmpp()},bindEvent:function(){var c=this;c.param.daily&&"true"==c.param.daily&&(k=location.protocol+"//mservice.daily.taobao.net/qrCodeApi.htm"),c.container.delegate("click",".J_QrRetry",function(b){c.param.api="retry",c.param._tt=(new Date).getTime(),a.IO({dataType:"jsonp",url:k,data:c.param,jsonpCallback:"QrCodeRetry",success:function(a){c.container.one(".J_QrCountdown").show(),c.countDown(c.container.one(".J_QrCountdown"),function(){c.container.one(".J_QrCountdown").hide(),c.container.one(".J_QrRetry").show()}),c.container.one(".J_QrRetry").hide()},error:function(a){}})}),c.container.delegate("click",".J_App_Cancle",function(d){c.param.daily&&"true"==c.param.daily&&(k=location.protocol+"//mservice.daily.taobao.net/qrCodeApi.htm"),c.param.api="cancle",c.param._tt=(new Date).getTime(),a.IO({dataType:"jsonp",url:k,data:c.param,jsonpCallback:"QrCodeCancle",success:function(a){c.container.hide(),6==b.ie&&c.$mask4ie6.hide()},error:function(a){}})}),c.container.delegate("click",".J_close",function(a){a.halt(),c.container.hide(),c.$mask4ie6&&c.$mask4ie6.css({left:-9999,top:-9999}).hide()}),c.container.delegate("click",".J_preview",function(a){a.halt(),c.previewUploadResult(c.param)})},show:function(){var a=this;a.isRender||a.render(),a.container.html(p),a.checkApp(),a.container.show(),a.$mask4ie6&&setTimeout(function(){a.$mask4ie6.css({left:a.container.css("left"),top:a.container.css("top")}).show()})},hide:function(a){var b=a||this;b.$mask4ie6&&b.$mask4ie6.css({left:-9999,top:-9999}).hide(),b.container.hide(),b.countdownInterval&&clearInterval(b.countdownInterval)},xmpp:function(){var a=this;a.xmppUtil.registerXmpp(a.param.subType,a)},xmppcallback:function(a){},previewUploadResult:function(b){var c=this;a.IO({dataType:"jsonp",url:location.protocol+"//"+h+"/previewUploadResult.htm",jsonpCallback:"getPreviewResult",data:{qrid:b.qrid,mk:b.mk},success:function(a){1==a.success&&a.data&&c.param.xmppcallback(a.data)},error:function(a){}})},offset:function(a,b){this.container.css({top:a,left:b})}}),f},{requires:["ua","node","event","pc-support/0.0.8/xmpp-util"]});